{% extends "core/base.html" %}

{% load static %}

{% block title %} {{item.name}} {% endblock %} 

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
  <!-- Image Carousel Section -->
  {% if item.all_images %}
    <div class="lg:col-span-3">
      <div class="relative bg-white rounded-xl shadow-lg overflow-hidden">
        <!-- Image Container -->
        <div class="relative h-[500px] lg:h-[600px] overflow-hidden">
          <!-- Main Image Display -->
          <div class="image-carousel w-full h-full">
            {% for image in item.all_images %}
              <img
                src="{{image.url}}"
                alt="{{item.name}}"
                class="w-full h-full object-contain bg-gray-100 {% if not forloop.first %}hidden{% endif %}"
                data-slide="{{forloop.counter0}}"
              />
            {% endfor %}
          </div>

          <!-- Navigation Arrows -->
          <button
            class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 p-3 rounded-full shadow-md transition-all duration-200 {% if item.all_images|length == 1 %} hidden {% endif %}"
          >
            ←
          </button>

          <button
            class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 p-3 rounded-full shadow-md transition-all duration-200 {% if item.all_images|length == 1 %} hidden {% endif %}"
          >
            →
          </button>
        </div>

        <!-- Pagination Dots -->
        <div
          class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2"
        >
          {% for image in item.all_images %}
            <button
              class="w-2 h-2 rounded-full bg-white bg-opacity-60 hover:bg-opacity-100 transition-all duration-200 {% if item.all_images|length == 1 %} hidden {% endif %}"
              data-slide-to="{{forloop.counter0}}"
            ></button>
          {% endfor %}
        </div>

        <!-- Image Counter -->
        <div
          class="absolute bottom-4 right-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm"
        >
          <span id="current-image">1</span> / {{item.all_images|length}}
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Right Sidebar -->
  <div class="lg:col-span-2 space-y-6">
    <!-- Main Item Information -->
    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100">
      <h1 class="text-3xl font-bold mb-4">{{item.name}}</h1>
      <div class="space-y-3">
        <p>
          <span class="font-bold text-lg">Price: </span>
          <span class="text-lg"
            >EGP {{item.price}}</span
          >
        </p>
        <p><span class="font-bold text-lg">Condition: </span><span class="text-lg">{{item.condition}}</span></p>
        <p><span class="font-bold text-lg">Location: </span><span class="text-lg">{{item.location}}</span></p>
      </div>

      {% if item.description %}
      <div class="mt-6 pt-6 border-t border-gray-200">
        <span class="font-bold text-lg mb-2 text-gray-700">Description:</span>
        <p class="text-gray-700 leading-relaxed">{{item.description}}</p>
      </div>
      {% endif %}
    </div>

    <!-- Seller Information Card -->
    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">
        Seller information
      </h2>

      <div class="flex items-center space-x-4 mb-6">
        <div
          class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center"
        >
          <span class="text-red-600 font-bold text-lg">
            {% if request.user == item.created_by %} Y {% else %}
            {{item.created_by.username|first|upper}} {% endif %}
          </span>
        </div>
        <div>
          <p class="font-semibold text-gray-900">
            {% if request.user == item.created_by %} 
              You 
            {% else %}
              {{item.created_by.username}} 
            {% endif %}
          </p>
          <p class="text-sm text-gray-500">
            Member since {{item.created_by.date_joined}}
          </p>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="space-y-3">
        {% if request.user == item.created_by %}
          <a
            href="{% url 'item:edit' item.id%}"
            class="w-full bg-teal-500 hover:bg-teal-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center"
          >
            Edit Item
          </a>
          <a
            href="{% url 'item:delete' item.id%}"
            class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center"
          >
            Delete Item
          </a>
        {% else %}
          <button
            class="w-full bg-red-100 hover:bg-red-200 text-red-600 font-semibold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center"
          >
            Chat
          </button>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Related Items Section -->
<div class="mt-12 px-6 py-12 bg-gray-100 rounded-xl">
  <h2 class="mb-12 text-2xl text-center font-bold text-gray-900">
    Related Items
  </h2>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for related_item in related_items %}
      <div
        class="group bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300"
      >
        <a href="{% url 'item:detail' related_item.id %}">
          <div class="aspect-square bg-gray-100 overflow-hidden">
            <img
              src="{{related_item.main_image.url}}"
              alt="{{ related_item.name }}"
              class="h-full w-full object-cover group-hover:scale-105 transition-transform duration-300"
            />
          </div>

          <div class="p-6 bg-white rounded-b-xl">
              <h2 class="text-2xl">{{related_item.name}}</h2>
              <p class="font-semibold">EGP {{related_item.price}}</p>
              <p class="text-gray-500">{{related_item.location}}</p>
          </div>
          
        </a>
      </div>
    {% endfor %}
  </div>
</div>

<!-- JavaScript for Image Carousel -->
<script src="{% static 'item/js/imageCarousel.js' %}"></script>
{% endblock %}
